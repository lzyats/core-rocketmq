# ====== 基础全局设置 ======
[mysqld]
# ---- 核心参数 ----
user                = mysql                     # Docker 容器内用户 
pid-file            = /var/run/mysqld/mysqld.pid 
socket              = /var/run/mysqld/mysqld.sock 
port                = 3306 
basedir             = /usr 
datadir             = /var/lib/mysql 
tmpdir              = /tmp
lc-messages-dir     = /usr/share/mysql
skip-name-resolve                               # 禁用DNS反向解析，提升连接速度 [1]()

lower_case_table_names=1
 
# ---- 字符集与时区 ----
character-set-server = utf8mb4                  # 推荐UTF8MB4支持4字节字符 
collation-server     = utf8mb4_unicode_ci 
default-time-zone   = '+08:00'                  # 按需设置时区 
 
# ====== 内存与缓存优化 ======
# ---- InnoDB 核心配置 ----
innodb_buffer_pool_size = 2G                    # 关键！建议分配物理内存的50-70% [1]()
innodb_log_file_size   = 512M                   # 日志文件大小，太大恢复慢，太小写频繁
innodb_log_buffer_size = 64M
innodb_flush_log_at_trx_commit = 1              # 事务安全级别 (1=最高, 2=折衷, 0=性能)
innodb_flush_method    = O_DIRECT               # 避免双缓冲，提升IO效率 
innodb_file_per_table  = ON                     # 每个表独立表空间，便于管理 
innodb_thread_concurrency = 0                   # 0=自动调整，多核CPU适用 
 
# ---- 查询缓存与连接 ----
query_cache_type       = OFF                    # MySQL 5.7+ 建议关闭 [1]()
max_connections        = 300                    # 根据容器资源调整
thread_cache_size      = 32                     # 线程缓存，减少连接开销
table_open_cache       = 2000                   # 打开表缓存数量 
 
# ====== 日志与监控 ======
# ---- 错误日志 ----
log_error            = /var/log/mysql/error.log 
 
# ---- 慢查询日志 ----
slow_query_log       = ON 
slow_query_log_file  = /var/log/mysql/slow.log  
long_query_time      = 2                        # 超过2秒的查询记录 
log_queries_not_using_indexes = OFF             # 避免日志膨胀 
 
# ---- Binlog (主从复制/备份) ----
server-id            = 1                        # 容器集群中需唯一 
log_bin              = /var/log/mysql/mysql-bin 
binlog_format        = ROW                      # 推荐ROW模式保证数据一致性
expire_logs_days     = 7                        # 自动清理旧Binlog
binlog_row_image     = minimal                  # 减少Binlog大小 
 
# ====== 安全加固 ======
secure-file-priv     = NULL                    # 禁止文件导入导出
local_infile         = OFF                     # 禁用本地文件加载
skip-symbolic-links  = ON                      # 防止符号链接攻击 
 
# ====== 容器化适配 ======
[mysqld_safe]
syslog               = NO                      # 避免与Docker日志驱动冲突
 
# ====== 客户端配置 ======
[client]
socket              = /var/run/mysqld/mysqld.sock 
default-character-set = utf8mb4 